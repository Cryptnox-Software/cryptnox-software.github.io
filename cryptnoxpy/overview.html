

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cryptnoxpy Overview &mdash; cryptnoxpy 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=f2a433a1"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API Reference" href="modules.html" />
    <link rel="prev" title="Cryptnoxpy Documentation" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            cryptnoxpy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Cryptnoxpy Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#cryptnox-python-communication-library">Cryptnox Python Communication Library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#license">License</a></li>
<li class="toctree-l3"><a class="reference internal" href="#documentation">Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installation-and-requirements">Installation and requirements</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#installation-of-this-library">Installation of this library</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installation-issues">Installation issues</a></li>
<li class="toctree-l4"><a class="reference internal" href="#update-issues">Update issues</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#library-use">Library use</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#remote-connection">Remote connection</a></li>
<li class="toctree-l4"><a class="reference internal" href="#initialization-and-pairing">Initialization and pairing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pin">PIN</a></li>
<li class="toctree-l4"><a class="reference internal" href="#seed-administration">Seed administration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#derivation-and-keys-system">Derivation and keys system</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ec-signature">EC Signature</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">cryptnoxpy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Cryptnoxpy Overview</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/overview.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="cryptnoxpy-overview">
<h1>Cryptnoxpy Overview<a class="headerlink" href="#cryptnoxpy-overview" title="Link to this heading"></a></h1>
<section id="cryptnox-python-communication-library">
<h2>Cryptnox Python Communication Library<a class="headerlink" href="#cryptnox-python-communication-library" title="Link to this heading"></a></h2>
<a class="reference external image-reference" href="https://pypi.org/project/cryptnoxpy"><img alt="https://img.shields.io/pypi/v/cryptnoxpy" src="https://img.shields.io/pypi/v/cryptnoxpy" />
</a>
<a class="reference external image-reference" href="https://cryptnoxpy.readthedocs.io/en/latest/?badge=latest"><img alt="Documentation Status" src="https://readthedocs.org/projects/cryptnoxpy/badge/?version=latest" />
</a>
<p>A Python3 library to use the <a class="reference external" href="https://www.cryptnox.com/">Cryptnox smartcard applet</a>.
It provides high level functions to send instructions to a Cryptnox Hardware Wallet Card and to manage its lifecycle.
The core module is <em>CryptnoxPy</em> which provides a <em>Connection</em> class to
establish a channel of communication that can be used to initialize a card instance through the
factory method.</p>
<p>To buy NFC enabled cards that are supported by this library go to:
<a class="reference external" href="https://www.cryptnox.com/">https://www.cryptnox.com/</a></p>
<section id="license">
<h3>License<a class="headerlink" href="#license" title="Link to this heading"></a></h3>
<p>The library is available under dual licensing. You can use the library under the
conditions of <a class="reference external" href="https://www.gnu.org/licenses/lgpl-3.0.en.html">GNU LESSER GENERAL PUBLIC LICENSE 3.0+</a>
or <a class="reference external" href="mailto:info&#37;&#52;&#48;cryptnox&#46;ch">contact us</a> to ask about commercial licensing.</p>
</section>
<section id="documentation">
<h3>Documentation<a class="headerlink" href="#documentation" title="Link to this heading"></a></h3>
<p>API documentation can be found in HTML format in the <a class="reference external" href="docs/html/index.html">docs folder</a>
It is generated using Sphynx from the code and can be generated in other formats too.</p>
</section>
<section id="installation-and-requirements">
<h3>Installation and requirements<a class="headerlink" href="#installation-and-requirements" title="Link to this heading"></a></h3>
<p>Requires :</p>
<ul class="simple">
<li><p>Python 3.11-3.13</p></li>
<li><p>PCSCd on Linux</p></li>
</ul>
<p>Ubuntu / Debian</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>swig<span class="w"> </span>python3-pip<span class="w"> </span>python3-setuptools<span class="w"> </span>pcscd<span class="w"> </span>libpcsclite-dev
pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>setuptools
</pre></div>
</div>
<p>Fedora / CentOS / RHEL</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>yum<span class="w"> </span>install<span class="w"> </span>swig<span class="w"> </span>python3-pip<span class="w"> </span>python3-setuptools<span class="w"> </span>pcsc-lite-ccid
pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>setuptools
</pre></div>
</div>
<p>On some Linux, starts PCSCd service</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>sudo<span class="o">)</span><span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>pcscd
<span class="o">(</span>sudo<span class="o">)</span><span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>pcscd
</pre></div>
</div>
<p>Mac OSX</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>brew<span class="w"> </span>install<span class="w"> </span>swig
</pre></div>
</div>
<section id="installation-of-this-library">
<h4>Installation of this library<a class="headerlink" href="#installation-of-this-library" title="Link to this heading"></a></h4>
<p>Make sure that you installed the required packages for your system.
See the “Requires” section above.</p>
<p>Install with pip:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>cryptnoxpy
</pre></div>
</div>
<p>Install from source:</p>
<p>Download and run in its directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>.
</pre></div>
</div>
<p>or:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>git+ssh://git@github.com/Cryptnox-Software/cryptnoxpy.git
</pre></div>
</div>
<p>This might require <em>sudo</em> on some systems.</p>
<p>Remove:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>uninstall<span class="w"> </span>cryptnoxpy
</pre></div>
</div>
</section>
<section id="installation-issues">
<h4>Installation issues<a class="headerlink" href="#installation-issues" title="Link to this heading"></a></h4>
<p>If the <strong>Linux system doesn't have Python 3.6, 3.7, 3.8 nor 3.9</strong>, install
Python 3.7 with the following recipe (Debian like):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>make<span class="w"> </span>build-essential<span class="w"> </span>libssl-dev<span class="w"> </span>zlib1g-dev<span class="w"> </span>swig<span class="w"> </span>libpcsclite-dev
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>libbz2-dev<span class="w"> </span>libreadline-dev<span class="w"> </span>libsqlite3-dev<span class="w"> </span>wget<span class="w"> </span>curl<span class="w"> </span>llvm<span class="w"> </span>git
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>libncurses5-dev<span class="w"> </span>libncursesw5-dev<span class="w"> </span>xz-utils<span class="w"> </span>tk-dev<span class="w"> </span>pcscd<span class="w"> </span>opensc
wget<span class="w"> </span>https://www.python.org/ftp/python/3.7.8/Python-3.7.8.tgz
tar<span class="w"> </span>xf<span class="w"> </span>Python-3.7.8.tgz
<span class="nb">cd</span><span class="w"> </span>Python-3.7.8
./configure<span class="w"> </span>--enable-optimizations
make<span class="w"> </span>-j8<span class="w"> </span>build_all
sudo<span class="w"> </span>make<span class="w"> </span>-j8<span class="w"> </span>altinstall

sudo<span class="w"> </span>pip3.7<span class="w"> </span>install<span class="w"> </span>git+ssh://git@gitlab.com/cryptnox-phase2/cryptnoxpy.git

<span class="c1"># or (if issue about agent forwarding with sudo) :</span>

<span class="nb">cd</span><span class="w"> </span>~
git<span class="w"> </span>clone<span class="w"> </span>git@gitlab.com:cryptnox-phase2/cryptnoxpy.git
<span class="nb">cd</span><span class="w"> </span>cryptnoxpy
sudo<span class="w"> </span>pip3.7<span class="w"> </span>install<span class="w"> </span>.
</pre></div>
</div>
<p>In case of <strong>pyscard can't be installed</strong> automatically with pip:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Try to pip3 install with sudo or root: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">.</span></code></p></li>
<li><p>If still a failure, install the following packages: Needed if pyscard can't be installed from package manager <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt</span> <span class="pre">install</span> <span class="pre">python3-dev</span> <span class="pre">swig</span> <span class="pre">libpcsclite-dev</span></code> then retry <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">.</span></code>.</p></li>
</ol>
</div></blockquote>
<p>If you use <strong>contactless readers</strong> on Linux, the RFID modules need to be disabled :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>rmmod<span class="w"> </span>pn533_usb
sudo<span class="w"> </span>rmmod<span class="w"> </span>pn533
sudo<span class="w"> </span>rm<span class="w"> </span>-r<span class="w"> </span>/lib/modules/*/kernel/drivers/nfc/pn533
</pre></div>
</div>
</section>
<section id="update-issues">
<h4>Update issues<a class="headerlink" href="#update-issues" title="Link to this heading"></a></h4>
<p>In case you just want to update the package, with old pip version on some Linux, it is better to remove and reinstall the package:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>pip<span class="w"> </span>uninstall<span class="w"> </span>cryptnoxpy
sudo<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>.
</pre></div>
</div>
</section>
</section>
<section id="library-use">
<h3>Library use<a class="headerlink" href="#library-use" title="Link to this heading"></a></h3>
<p>To get the card a connection has to be established with the reader’s index. The connection can
then be passed to the factory that will initialize an object for the card in the reader from the
correct class for the card type and version.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">cryptnoxpy</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="n">cryptnoxpy</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="k">except</span> <span class="n">cryptnoxpy</span><span class="o">.</span><span class="n">ReaderException</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reader not found on index&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">card</span> <span class="o">=</span> <span class="n">cryptnoxpy</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">get_card</span><span class="p">(</span><span class="n">connection</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">cryptnoxpy</span><span class="o">.</span><span class="n">CryptnoxException</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="c1"># There is an issue with loading the card</span>
        <span class="c1"># CryptnoxException is the base exception class for module</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Card is loaded and can be used</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Card serial number: </span><span class="si">{</span><span class="n">card</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The factory will:</p>
<ul class="simple">
<li><p>connect to the card</p></li>
<li><p>select the applet</p></li>
<li><p>read the applet parameters</p></li>
<li><p>select class to handle the card</p></li>
</ul>
<p>The card contains basic information:</p>
<ul class="simple">
<li><p>card.serial_number : Integer : Card/applet instance Unique ID</p></li>
<li><p>card.applet_version : 3 integers list : Applet version (ex. 1.2.2)</p></li>
</ul>
<section id="remote-connection">
<h4>Remote connection<a class="headerlink" href="#remote-connection" title="Link to this heading"></a></h4>
<p>The connection can also be initialized with a socket connection client in a list, and a True value for the ‘remote’ parameter.
This enables use with a remote client, communicating apdu commands over the socket connection.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">cryptnoxpy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">socket</span>

<span class="n">server</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="n">server</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="n">SERVER_IP</span><span class="p">,</span><span class="n">SERVER_PORT</span><span class="p">))</span>
<span class="n">server</span><span class="o">.</span><span class="n">listen</span><span class="p">()</span>
<span class="n">conn</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="n">cryptnoxpy</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="kc">False</span><span class="p">,[</span><span class="n">conn</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span>
<span class="k">except</span> <span class="n">cryptnoxpy</span><span class="o">.</span><span class="n">ReaderException</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reader not found on index&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">card</span> <span class="o">=</span> <span class="n">cryptnoxpy</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">get_card</span><span class="p">(</span><span class="n">connection</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">cryptnoxpy</span><span class="o">.</span><span class="n">CryptnoxException</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="c1"># There is an issue with loading the card</span>
        <span class="c1"># CryptnoxException is the base exception class for module</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Card is loaded and can be used</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Card serial number: </span><span class="si">{</span><span class="n">card</span><span class="o">.</span><span class="n">serial_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="initialization-and-pairing">
<h4>Initialization and pairing<a class="headerlink" href="#initialization-and-pairing" title="Link to this heading"></a></h4>
<p>Right after the installation, the applet is not initialized, and the user needs
to send some parameters to use the card. The initialization can be executed once.
Any change of the base parameters requires a full applet reinstallation
(except PIN/PUK change).</p>
<p>After the initialization, the card and the PC must share a common secret to be
used as authenticated secure channel. This secret is required any time further,
to communicate with the card (using a secure channel). The registration of this
common secret is done during the init phase.</p>
<p>The init parameters required are :</p>
<ul class="simple">
<li><p>Name  (up to 20 chars string)</p></li>
<li><p>Email (up to 60 chars string)</p></li>
<li><p>PIN (9 digits string)</p></li>
<li><p>PUK (15 digits string)</p></li>
<li><p>optional : the first Paring Secret (32 bytes bytearray)</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pairing_key</span> <span class="o">=</span> <span class="n">card</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">puk</span><span class="p">,</span> <span class="n">pairing_secret</span><span class="p">)</span>
</pre></div>
</div>
<p>The returned data is the first PairingKey (32 bytes byte-array) and its index (0) :
<code class="docutils literal notranslate"><span class="pre">0x00</span> <span class="pre">+</span> <span class="pre">ParingKeySlot0</span></code></p>
<p>During the initialization phase, until the user public key for authentication
registration is allowed, the set_pairing_key command is also allowed.
Then set_pairing_key needs the applet to have the signature unlocked.</p>
<p>After getting the pairing_key, the user needs to store it in a safe place.
In the case the client would communicate with several cards, the user needs to
associate the pairing_key with the instance serial number of the card, so that the user
client can keep track of multiple cards, and use the right one with the right
card. The pairing_key must be saved in a file to reconnect the next time to this
card. It should be saved with the serial number of card in order to associate this card with this
key.</p>
<p>A common hardcoded PairingKey can be used.</p>
<p>After this init phase, the secure channel must be used with all communications
with the card. A secure channel is an encrypted and 2-ways authenticated link
layer with the card using standards APDU messages. Many applet commands require
a secure channel.</p>
</section>
<section id="pin">
<h4>PIN<a class="headerlink" href="#pin" title="Link to this heading"></a></h4>
<p>The PIN chosen during the initialization needs to be provided after each card
reset, and a secure channel is opened.</p>
<p>To test a PIN string, simply use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">card</span><span class="o">.</span><span class="n">verify_pin</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="seed-administration">
<h4>Seed administration<a class="headerlink" href="#seed-administration" title="Link to this heading"></a></h4>
<p>The applet manages a 256 bits master secret called the “seed”. This is the BIP32
Master Seed, and can be externally computed from a mnemonic to a binary seed
using BIP39. The key pairs used for ECDSA are then computationally derived from
this seed using BIP32 derivation scheme.</p>
<section id="seed-generation">
<h5>Seed generation<a class="headerlink" href="#seed-generation" title="Link to this heading"></a></h5>
<p>The seed can be generated in the card using the random number generator in the
java chip system (AIS 20 class DRG.3). Doing this way, the seed secret never
escapes the card protection.</p>
<p>The method to generate a new seed key is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">card</span><span class="o">.</span><span class="n">generate_seed</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span>
</pre></div>
</div>
<p>The card can also randomly generate BIP39 mnemonics words list. But in this
case, the query answer is only output and not used internally by the card.
It is administrator responsibility to get a mnemonic using the GENERATE MNEMONIC
command and then eventually compute the corresponding seed, which can be
uploaded in the card using RECOVER KEY command.
We don’t recommend doing so, this is very insecure, as the seed is exposed in
clear and full in the user’s system.</p>
</section>
<section id="recovery">
<h5>Recovery<a class="headerlink" href="#recovery" title="Link to this heading"></a></h5>
<p>The Cryptnox applet can load binary seed.</p>
<p>The seed is loaded in the card using this method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">card</span><span class="o">.</span><span class="n">load_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="n">pin</span><span class="p">)</span>
</pre></div>
</div>
<p>Seed is 32 bytes.</p>
<p>Once this seed is loaded in the card using the load_seed method, this card now
behaves like were (or the one) it was backup. Be aware that key derivation
paths are not backup, and must be identical to retrieve the same key pairs.
See derivation and key system just below for more details.</p>
<p>For more details about the recovery, see load_seed operation in the API documentation.</p>
</section>
</section>
<section id="derivation-and-keys-system">
<h4>Derivation and keys system<a class="headerlink" href="#derivation-and-keys-system" title="Link to this heading"></a></h4>
<p>The card applet is fully compliant with
<a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki">BIP32</a>,
except the maximum depth of derivation from the master key is 8 levels.
It can be turned on for the card to return extended public keys for use in applications
requiring it.</p>
<p>The card stores the present key pair (and its parent), used for signature.
This can be changed using the derive method, and also during a signature
command, giving a relative path (from the present key pair), or in an absolute path
(from the master key pair). See derive method in the API documentation.</p>
<p>Any derivation aborts any opened signing sessions and resets the authentications
for signature. The generated key is used for all subsequent sign sessions.</p>
<p>The ability to start derivation from the parent keys allows to more efficiently
switch between children of the same key. Note however that only the immediate
parent of the current key is cached so one cannot use this to go back in the
keys hierarchy.</p>
<p>For ease of use, the user can derive from the root master node key pair
(absolute path) at each card startup, or even before each signature.
This takes a couple of seconds. So this is better to store intermediate public
keys hash and check the status to observe the current key pair in use.
This off-card complex key management is not needed if the signatures volume
is below one thousand per day.</p>
<p>See derive and sign methods in the API documentation.</p>
</section>
<section id="ec-signature">
<h4>EC Signature<a class="headerlink" href="#ec-signature" title="Link to this heading"></a></h4>
<p>The derivation of the key pair node can be also possible using the signature
command (relative or absolute).</p>
<p>The card applet can sign any 256 bits hash provided, using ECDSA with 256k1 EC
parameters. Most of the blockchain system used SHA2-256 to hash the message,
but this card applet is agnostic from this point, since the signature is performed on
a hash provided by the user. Note that this hash needs to be confirmed by the
users beforehand, when they provide their EC384 signature of this hash.</p>
<p>The code to sign with the EC current key node is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">signature</span> <span class="o">=</span> <span class="n">card</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">data_hash</span><span class="p">,</span> <span class="n">cryptnoxpy</span><span class="o">.</span><span class="n">Derivation</span><span class="o">.</span><span class="n">CURRENT_KEY</span><span class="p">)</span>
</pre></div>
</div>
<p>data_hash is a byte-array containing the EC hash to sign using ECDSA ecp256k1:</p>
<p>The signature a byte array, encoded as an ASN1 DER sequence of two INTEGER values, r and s.</p>
<p>See the sign method in the API documentation for more information.</p>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Cryptnoxpy Documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="modules.html" class="btn btn-neutral float-right" title="API Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Cryptnox.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>